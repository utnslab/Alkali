#include "runtime.h"
#include "extern.h"
#include "ep2.inc.h"
#include "stdint.h"
#include <stdio.h>

const int MSG_SIZE = 512;

// table name
void __handler_NET_RECV_process_packet(buf_t *buf);

void run_ids() {
  void * bufd = aligned_alloc(64, MSG_SIZE);
  uint8_t data[] = {
    0xB8,0x3F,0xD2,0x54,0xBE,0x7B,0xE8,0xEB,0xD3,0xF7,0x79,0x5F,0x08,0x00,0x45,0x00,0x00,0x4C,0xA1,0xE9,0x40,0x00,0x40,0x11,0x01,0x1D,0xC0,0xA8,0x0B,0x11,0xC0,0xA8,0x0B,0x64,0x23,0x28,0x03,0xEC,0x00,0x30,0xFD,0x27,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
  };

  for (int i = 0; i < 8; i++) {
    memcpy(bufd, data, sizeof(data));
    buf_t buf = {.data = bufd, .size = sizeof(data), .offset = 0};
    __handler_NET_RECV_process_packet(&buf);
    printf("finish processing packet %d, buf.offset = %d\n",i, buf.offset);
  }
}

#if 0
void __handler_OoO_DETECT_OoO_detection(void *v1, void *p2, int16_t v3, void *p4, void *p5, void *p6);
void __wrapper____handler_OoO_DETECT_OoO_detection(void *v1, void *p2, int16_t v3, void *p4, void *p5, void *p6) {
  __handler_OoO_DETECT_OoO_detection(v1, p2, v3, p4, p5, p6);
}

void __handler_ACK_GEN_ack_gen(void *v1, void *p2, int16_t v3, void *p4, void *p5, void *p6);
void __wrapper____handler_ACK_GEN_ack_gen(void *v1, void *p2, int16_t v3, void *p4, void *p5, void *p6) {
  __handler_ACK_GEN_ack_gen(v1, p2, v3, p4, p5, p6);
}
#endif

void run_rx_single() {
  void * bufd = aligned_alloc(64, MSG_SIZE);
  uint8_t data[] = {
    0xB8,0x3F,0xD2,0x54,0xBE,0x7B,0xE8,0xEB,0xD3,0xF7,0x79,0x5F,0x08,0x00,0x45,0x00,0x00,0x4C,0xA1,0xE9,0x40,0x00,0x40,0x11,0x01,0x1D,0xC0,0xA8,0x0B,0x11,0xC0,0xA8,0x0B,0x64,0x23,0x28,0x03,0xEC,0x00,0x30,0xFD,0x27,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
  };

  for (int i = 0; i < 8; i++) {
    memcpy(bufd, data, sizeof(data));
    buf_t buf = {.data = bufd, .size = sizeof(data), .offset = 0};
    __handler_NET_RECV_process_packet(&buf);
    printf("finish processing packet %d, buf.offset = %d\n",i, buf.offset);
  }
}

int main() {
  // init table
  __ep2_init();

  // init message
  run_rx_single();
}
